let totalRotations = 0; // Total acumulado desde que inició la sesión

function updateDataFromFirebase(snapshot) {
    const data = snapshot.val();
    if (!data) return;

    const now = new Date();
    const timeString = now.getHours() + ':' + now.getMinutes().toString().padStart(2,'0');

    const temperature = data.sensor?.temperatura || 0;
    const humidity = data.sensor?.humedad || 0;
    const motorSpeed = data.motor?.rpm || 0;
    const motorState = data.motor?.encendido || false;
    const vueltasActuales = data.motor?.vueltas || 0; // lectura actual de vueltas

    // Guardar valores anteriores para tendencias
    const prevRotation = rotationData.length > 0 ? rotationData[rotationData.length - 1] : vueltasActuales;

    // Actualizar arrays de datos
    timeStamps.push(timeString);
    rotationData.push(vueltasActuales);
    if (rotationData.length > maxDataPoints) {
        timeStamps.shift();
        rotationData.shift();
    }

    // Actualizar total acumulado (si quieres acumular desde la primera lectura)
    totalRotations += (vueltasActuales - prevRotation); 
    if (totalRotations < 0) totalRotations = vueltasActuales; // por si resetea el contador

    // Actualizar la UI
    document.getElementById('motorRotation').textContent = vueltasActuales;
    document.getElementById('totalRotations').textContent = totalRotations;

    // Actualizar tendencias
    document.getElementById('rotation-trend').innerHTML = getTrendIcon(vueltasActuales, prevRotation);
    updateTrendStyle('rotation-trend', vueltasActuales, prevRotation);

    // Actualizar gráfico
    updateChart(rotationChart, timeStamps, rotationData);

    // --- resto de tu código de actualización de motor, temperatura y humedad ---
}
